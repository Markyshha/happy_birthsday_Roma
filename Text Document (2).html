<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, –†–æ–º–∞! ‚Äî 14 üéâ</title>
  <meta name="description" content="–°—É–ø–µ—Ä-–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏—á..., –∫–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã, –º–∏–Ω–∏-–∏–≥—Ä—ã, –≥–æ—Å—Ç–µ–≤–∞—è –∫–Ω–∏–≥–∞ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!" />
  <style>
    :root {
      --bg1: #0f172a; /* slate-900 */
      --bg2: #1e293b; /* slate-800 */
      --card: #0b1022;
      --text: #e2e8f0; /* slate-200 */
      --muted: #94a3b8; /* slate-400 */
      --accent: #22d3ee; /* cyan-400 */
      --accent2: #a78bfa; /* violet-400 */
      --success: #34d399; /* emerald-400 */
      --danger: #fb7185; /* rose-400 */
      --warning: #fbbf24; /* amber-400 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .light {
      --bg1: #f8fafc; /* slate-50 */
      --bg2: #e2e8f0; /* slate-200 */
      --card: #ffffff;
      --text: #0f172a; /* slate-900 */
      --muted: #334155; /* slate-700 */
      --accent: #06b6d4; /* cyan-500 */
      --accent2: #7c3aed; /* violet-600 */
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, "Noto Color Emoji", "Apple Color Emoji", sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, rgba(34,211,238,.12), transparent),
                  radial-gradient(1200px 800px at 120% 10%, rgba(167,139,250,.12), transparent),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }

    /* Floating festive shapes */
    .floaty {
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
    }
    .floaty span {
      position: absolute; font-size: clamp(18px, 2.2vw, 36px); opacity: .25; filter: drop-shadow(0 2px 4px rgba(0,0,0,.35));
      animation: drift linear infinite;
    }
    @keyframes drift {
      from { transform: translateY(110vh) rotate(0deg); }
      to   { transform: translateY(-20vh) rotate(360deg); }
    }

    header {
      position: relative; z-index: 6;
      padding: 28px 16px 8px; text-align: center;
    }
    .title {
      font-size: clamp(28px, 4.8vw, 56px);
      line-height: 1.05; letter-spacing: .5px; margin: 0 0 10px;
      color: #ffffff;
      background: none;
      -webkit-background-clip: initial; background-clip: initial;
      text-shadow: none;
    }
    .subtitle { margin: 0 auto; max-width: 900px; color: var(--muted); font-size: clamp(14px, 1.8vw, 18px); }

    /* Toolbar */
    .toolbar {
      position: sticky; top: 0; z-index: 7;
      display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;
      padding: 10px 12px; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.05));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .btn {
      border: 0; border-radius: 16px; padding: 10px 14px; cursor: pointer; font-weight: 700;
      color: #0b1022; background: #fff; box-shadow: var(--shadow);
      transition: transform .08s ease, filter .2s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); filter: brightness(.95); }
    .btn.accent { background: linear-gradient(90deg, var(--accent), var(--accent2)); color: #021016; }
    .btn.ghost { background: rgba(255,255,255,.12); color: var(--text); border: 1px solid rgba(255,255,255,.18); }

    /* Layout */
    .container { position: relative; z-index: 6; padding: 24px 16px 70px; max-width: 1100px; margin: 0 auto; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 18px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px; padding: 18px; box-shadow: var(--shadow);
    }
    .card h2 { margin: 0 0 10px; font-size: clamp(18px, 2.4vw, 24px); }
    .card p { color: var(--muted); }

    .pill { display: inline-flex; align-items: center; gap: 8px; font-weight: 700; padding: 8px 12px; border-radius: 999px; background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.18); }

    /* Canvas layers */
    #fwCanvas { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

    /* Confetti area */
    #confetti { position: fixed; inset: 0; pointer-events: none; z-index: 5; overflow: visible; }

    /* Typewriter */
    .typewriter { min-height: 64px; font-weight: 800; font-size: clamp(18px, 3vw, 28px); }

    /* Balloons */
    .balloon-zone { position: relative; height: 220px; overflow: hidden; border-radius: 18px; }
    .balloon { position: absolute; bottom: -120px; width: 48px; aspect-ratio: 1/1.25; border-radius: 40px 40px 35px 35px/50px 50px 35px 35px; box-shadow: inset -6px -10px 18px rgba(0,0,0,.25); cursor: pointer; }
    .string { position: absolute; width: 2px; height: 70px; background: rgba(255,255,255,.6); left: 50%; transform: translateX(-50%); top: 90%; }
    @keyframes rise { from { transform: translateY(0); } to { transform: translateY(-340px); } }

    /* Game: balloon inflate */
    .inflate { display: grid; gap: 10px; place-items: center; }
    .inflate .bubble { width: 90px; height: 90px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.12)); box-shadow: inset -10px -14px 24px rgba(0,0,0,.35), var(--shadow); transition: transform .08s; }
    .score { font-weight: 800; }

    /* Guestbook */
    .guestbook { display: grid; gap: 10px; }
    .gb-list { display: grid; gap: 8px; max-height: 220px; overflow: auto; padding-right: 6px; }
    .gb-item { background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.12); border-radius: 12px; padding: 8px 10px; }

    /* Quiz */
    .quiz { display: grid; gap: 8px; }
    .q { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); border-radius: 12px; padding: 10px; }
    .q h3 { margin: 0 0 8px; }
    .q label { display: block; margin: 6px 0; cursor: pointer; }

    /* Footer */
    footer { text-align: center; padding: 22px; color: var(--muted); }

    /* Fancy underline */
    .underline { background: linear-gradient(90deg, var(--accent), var(--accent2)); height: 3px; border-radius: 999px; width: 100px; margin: 8px auto 0; }

    /* Responsive adjustments */
    @media (max-width: 520px) { .toolbar { justify-content: flex-start; } }
  </style>
</head>
<body>
  <canvas id="fwCanvas"></canvas>
  <svg id="confetti"></svg>
  <div class="floaty" id="floaty"></div>

  <header>
    <h1 class="title">–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, –†–æ–º–∞! <span aria-hidden>üéâ</span> –¢–µ–±–µ 14!</h1>
    <p class="subtitle">–ü—Ä—ã–≥–∞–π –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º, –∑–∞–ø—É—Å–∫–∞–π —Å–∞–ª—é—Ç—ã, –≤–∑—Ä—ã–≤–∞–π –∫–æ–Ω—Ñ–µ—Ç—Ç–∏, –∏–≥—Ä–∞–π ‚Äî —Å–µ–≥–æ–¥–Ω—è –≤—Å—ë –º–æ–∂–Ω–æ. –≠—Ç–æ—Ç —Å–∞–π—Ç ‚Äî –æ–¥–∏–Ω —Ñ–∞–π–ª, –Ω–æ —Ü–µ–ª–∞—è –≤–µ—á–µ—Ä–∏–Ω–∫–∞! ü•≥</p>
    <div class="underline"></div>
  </header>

  <div class="toolbar" role="toolbar" aria-label="–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–∞—è –ø–∞–Ω–µ–ª—å">
    <button class="btn accent" id="fireBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∞–ª—é—Ç üí•</button>
    <button class="btn" id="confettiBtn">–ö–æ–Ω—Ñ–µ—Ç—Ç–∏! üéä</button>
    <button class="btn" id="themeBtn" aria-pressed="false">–¢–µ–º–∞: —Ç—ë–º–Ω–∞—è</button>
    <button class="btn" id="musicBtn" aria-pressed="false">–ú—É–∑—ã–∫–∞: –≤—ã–∫–ª üîà</button>
    <button class="btn ghost" id="cleanBtn" title="–û—á–∏—Å—Ç–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã">–û—á–∏—Å—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω üßπ</button>
  </div>

  <main class="container">
    <section class="grid" style="margin-bottom: 16px;">
      <article class="card" style="grid-column: 1/-1;">
        <div class="pill">üíå –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
        <div class="typewriter" id="typewriter"></div>
        <p style="margin-top:8px">–ù–∞–∂–º–∏ ¬´–ö–æ–Ω—Ñ–µ—Ç—Ç–∏!¬ª —Å–≤–µ—Ä—Ö—É ‚Äî –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫ —Å—Ç–∞–Ω–µ—Ç –µ—â—ë —è—Ä—á–µ. –ê –µ—â—ë –≤–Ω–∏–∑—É –µ—Å—Ç—å –∏–≥—Ä—ã –∏ –≥–æ—Å—Ç–µ–≤–∞—è –∫–Ω–∏–≥–∞.</p>
      </article>

      <article class="card">
        <h2>üéà –®–∞—Ä—ã –≤ –Ω–µ–±–æ</h2>
        <p>–ö–ª–∏–∫–∞–π –ø–æ —à–∞—Ä–∞–º ‚Äî –ª–æ–ø–∞—é—Ç—Å—è —Å —Ö–ª–æ–ø–∫–æ–º –∏ –¥–∞—Ä—è—Ç –æ—á–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.</p>
        <div class="balloon-zone" id="balloonZone" aria-live="polite"></div>
      </article>

      <article class="card">
        <h2>ü´ß –ú–∏–Ω–∏-–∏–≥—Ä–∞: ¬´–ù–∞–¥—É–π —à–∞—Ä–∏–∫¬ª</h2>
        <div class="inflate">
          <div class="bubble" id="bubble"></div>
          <button class="btn" id="inflateBtn" aria-label="–ó–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞–¥—É–≤–∞—Ç—å">–ó–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞–¥—É–≤–∞—Ç—å ‚è∫Ô∏è</button>
          <div class="score">–°—É–ø–µ—Ä-–≤–∑—Ä—ã–≤–æ–≤: <span id="popScore">0</span></div>
        </div>
      </article>

      <article class="card">
        <h2>üìù –ì–æ—Å—Ç–µ–≤–∞—è –∫–Ω–∏–≥–∞</h2>
        <div class="guestbook">
          <input id="gbName" placeholder="–¢–≤–æ—ë –∏–º—è" class="btn ghost" style="width:100%" />
          <textarea id="gbText" placeholder="–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –†–æ–º—ã" class="btn ghost" style="min-height:80px; width:100%; resize:vertical"></textarea>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" id="gbAdd">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å ‚úçÔ∏è</button>
            <button class="btn" id="gbSave">–°–∫–∞—á–∞—Ç—å –≤—Å–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è ‚¨áÔ∏è</button>
            <button class="btn ghost" id="gbClear">–û—á–∏—Å—Ç–∏—Ç—å üóëÔ∏è</button>
          </div>
          <div class="gb-list" id="gbList" aria-live="polite"></div>
        </div>
      </article>

      <article class="card">
        <h2>üéÅ –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</h2>
        <canvas id="wheel" width="280" height="280" style="width:100%;max-width:320px;border-radius:50%;background:rgba(255,255,255,.06);"></canvas>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
          <button class="btn" id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ üîÑ</button>
          <div class="pill" id="wheelResult">‚Äî</div>
        </div>
      </article>

      <article class="card">
        <h2>‚ú® –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</h2>
        <p>–ù–∞–∂–∏–º–∞–π –Ω–∞ –ø–ª–∏—Ç–∫–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è!</p>
        <div id="wishes" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;"></div>
      </article>

      <article class="card" style="grid-column: 1/-1;">
        <h2>üß† –ö–≤–∏–∑: –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –≥–µ–Ω–∏–π?</h2>
        <div class="quiz" id="quiz"></div>
        <button class="btn" id="quizCheck">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã ‚úÖ</button>
        <div id="quizResult" class="pill" style="margin-top:8px; display:none"></div>
      </article>

      <article class="card">
        <h2>ü™Ñ –¢—Ä—é–∫–∏</h2>
        <ul>
          <li>–ù–∞–∂–º–∏ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –º–∏–Ω–∏-—Å–∞–ª—é—Ç.</li>
          <li>–ù–∞–∂–º–∏ <strong>–ö</strong> + <strong>–û</strong> + <strong>–ù</strong> + <strong>–ê</strong> + <strong>–ú</strong> + <strong>–ò</strong> ‚Äî –ø–æ–π–¥—ë—Ç –¥–æ–∂–¥—å –∏–∑ —Ç–æ—Ä—Ç–∏–∫–æ–≤ üéÇ.</li>
        </ul>
      </article>
    </section>
  </main>

  <footer>
    –°–¥–µ–ª–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é –¥–ª—è –†–æ–º—ã üíô ‚Äî –æ–¥–∏–Ω HTML-—Ñ–∞–π–ª, –Ω–æ–ª—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
  </footer>

  <script>
    // ---------------------- Utilities ----------------------
    const $ = (s, p=document) => p.querySelector(s);
    const $$ = (s, p=document) => Array.from(p.querySelectorAll(s));

    function rand(min, max) { return Math.random() * (max - min) + min; }
    function pick(arr) { return arr[Math.floor(Math.random()*arr.length)]; }

    // ---------------------- Typewriter ----------------------
    const typeTarget = $('#typewriter');
    const lines = [
      '–†–æ–º–∞, –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å 14! –ü—É—Å—Ç—å –∫–∞–∂–¥–æ–µ –∂–µ–ª–∞–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è —Å–±—ã–≤–∞–µ—Ç—Å—è ‚ú®',
      '–ë–æ–ª—å—à–µ —Å–º–µ—Ö–∞, –ø–æ–±–µ–¥ –∏ –∫—Ä—É—Ç—ã—Ö –∏–¥–µ–π ‚Äî —Ç—ã —Ç–æ–ø! üî•',
      '–ü—É—Å—Ç—å —Ç–≤–æ–π –≥–æ–¥ –±—É–¥–µ—Ç –∫–∞–∫ —ç—Ç–æ—Ç —Å–∞–π—Ç: —è—Ä–∫–∏–π, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏ –æ—á–µ–Ω—å –≤–µ—Å—ë–ª—ã–π üéâ'
    ];
    async function typeLines() {
      typeTarget.textContent = '';
      for (const line of lines) {
        for (const ch of line) {
          typeTarget.textContent += ch;
          await new Promise(r => setTimeout(r, 22 + Math.random()*18));
        }
        await new Promise(r => setTimeout(r, 600));
        typeTarget.textContent += '\n';
      }
    }
    typeLines();

    // ---------------------- Floating emojis ----------------------
    const floaty = $('#floaty');
    const floatIcons = ['üéà','üéâ','üéÇ','‚≠ê','üéä','ü™©','üßÅ','üç≠','üí´','üü£','üîµ','üü°'];
    for (let i=0;i<36;i++) {
      const s = document.createElement('span');
      s.textContent = pick(floatIcons);
      s.style.left = rand(-5, 100) + 'vw';
      s.style.top = rand(-10, 110) + 'vh';
      s.style.animationDuration = (rand(12, 36)) + 's';
      s.style.animationDelay = (-rand(0, 36)) + 's';
      floaty.appendChild(s);
    }

    // ---------------------- Fireworks ----------------------
    const fw = $('#fwCanvas');
    const fctx = fw.getContext('2d');
    let W = fw.width = innerWidth, H = fw.height = innerHeight;
    addEventListener('resize', () => { W = fw.width = innerWidth; H = fw.height = innerHeight; });

    let particles = [];
    function burst(x, y, colors= ['#22d3ee','#a78bfa','#fbbf24','#34d399','#fb7185']) {
      for (let i=0;i<160;i++) {
        const angle = Math.random()*Math.PI*2;
        const speed = rand(1.5, 6);
        particles.push({
          x, y,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed,
          life: rand(40, 80),
          color: pick(colors),
        });
      }
    }
    function loop() {
      // reduced alpha so the canvas trail doesn't create a full black overlay
      fctx.fillStyle = 'rgba(0,0,0,0.06)';
      fctx.fillRect(0,0,W,H);
      particles.forEach(p => {
        p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.life -= 1;
        fctx.fillStyle = p.color;
        fctx.fillRect(p.x, p.y, 2, 2);
      });
      particles = particles.filter(p => p.life>0 && p.y<H+4);
      requestAnimationFrame(loop);
    }
    loop();

    // Click to burst
    addEventListener('click', e => {
      if (e.target.closest('.btn, input, textarea, label')) return; // avoid UI clicks
      burst(e.clientX, e.clientY);
    });

    // Toolbar buttons
    $('#fireBtn').addEventListener('click', () => burst(rand(100, W-100), rand(100, H-200)));

    // ---------------------- Confetti ----------------------
    const confettiSvg = $('#confetti');
    function confetti() {
      for (let i=0;i<180;i++) {
        const r = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        const size = rand(4, 10);
        r.setAttribute('width', size);
        r.setAttribute('height', size * rand(.6, 1.6));
        r.setAttribute('x', rand(0, innerWidth));
        r.setAttribute('y', -20);
        r.setAttribute('fill', pick(['#22d3ee','#a78bfa','#fbbf24','#34d399','#fb7185']));
        const dur = rand(2.6, 4.6);
        r.style.transition = `transform ${dur}s linear, opacity ${dur}s linear`;
        r.style.transform = `translate(${rand(-60,60)}px, ${innerHeight + rand(20,120)}px) rotate(${rand(0,720)}deg)`;
        confettiSvg.appendChild(r);
        requestAnimationFrame(() => r.style.transform = `translate(${rand(-200,200)}px, ${innerHeight + rand(20,120)}px) rotate(${rand(360,1440)}deg)`);
        setTimeout(()=> r.remove(), dur*1000);
      }
      // tiny sound
      blip(880, 0.04); blip(660, 0.05); blip(990, 0.04);
    }
    $('#confettiBtn').addEventListener('click', confetti);

    $('#cleanBtn').addEventListener('click', ()=> { confettiSvg.innerHTML = ''; particles = []; fctx.clearRect(0,0,W,H); });

    // ---------------------- Theme toggle ----------------------
    const themeBtn = $('#themeBtn');
    themeBtn.addEventListener('click', ()=>{
      const light = document.body.classList.toggle('light');
      themeBtn.textContent = light ? '–¢–µ–º–∞: —Å–≤–µ—Ç–ª–∞—è' : '–¢–µ–º–∞: —Ç—ë–º–Ω–∞—è';
    });

    // ---------------------- Balloons ----------------------
    const balloonZone = $('#balloonZone');
    function makeBalloon() {
      const b = document.createElement('div');
      b.className = 'balloon';
      const hue = Math.floor(rand(0, 360));
      b.style.background = `radial-gradient(circle at 30% 25%, hsla(${hue},100%,90%,.95), hsla(${hue},80%,55%,1))`;
      b.style.left = rand(0, 90) + '%';
      b.style.animation = `rise ${rand(6, 12)}s linear forwards`;
      const s = document.createElement('div'); s.className = 'string'; b.appendChild(s);
      b.addEventListener('click', () => { popBalloon(b); });
      balloonZone.appendChild(b);
      setTimeout(()=> b.remove(), 13000);
    }
    function popBalloon(el) {
      el.style.transition = 'transform .12s ease, opacity .12s ease';
      el.style.transform = 'scale(1.2)';
      el.style.opacity = '0';
      setTimeout(()=> el.remove(), 120);
      // little star burst
      burst(el.offsetLeft + el.offsetWidth/2, balloonZone.getBoundingClientRect().top + 10);
      blip(1200, 0.06);
      mood++; updateMood();
    }
    setInterval(makeBalloon, 900);

    // Mood score
    let mood = 0; const moodPill = document.createElement('div');
    moodPill.className = 'pill'; moodPill.style.position='absolute'; moodPill.style.top='10px'; moodPill.style.right='10px';
    moodPill.textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: 0'; balloonZone.appendChild(moodPill);
    function updateMood(){ moodPill.textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ' + mood; }

    // ---------------------- Inflate game ----------------------
    const bubble = $('#bubble');
    const inflateBtn = $('#inflateBtn');
    const popScore = $('#popScore');
    let inflating = false, size = 1, pops = 0, rafId;

    function grow() {
      size += 0.014 + size*0.006; // progressive
      bubble.style.transform = `scale(${size})`;
      if (size > 2.2) {
        // pop!
        burst(bubble.getBoundingClientRect().left + 45, bubble.getBoundingClientRect().top + 45);
        blip(1300, 0.08); blip(900, 0.06);
        pops++; popScore.textContent = pops;
        size = 1; bubble.style.transform = 'scale(1)';
        return;
      }
      rafId = requestAnimationFrame(grow);
    }
    inflateBtn.addEventListener('mousedown', ()=>{ inflating = true; cancelAnimationFrame(rafId); grow(); });
    inflateBtn.addEventListener('mouseup', ()=>{ inflating = false; cancelAnimationFrame(rafId); });
    inflateBtn.addEventListener('mouseleave', ()=>{ inflating = false; cancelAnimationFrame(rafId); });
    // touch
    inflateBtn.addEventListener('touchstart', e=>{ e.preventDefault(); inflating = true; cancelAnimationFrame(rafId); grow(); }, {passive:false});
    inflateBtn.addEventListener('touchend', ()=>{ inflating = false; cancelAnimationFrame(rafId); });

    // ---------------------- Guestbook ----------------------
    const gbName = $('#gbName');
    const gbText = $('#gbText');
    const gbList = $('#gbList');
    const gbAdd = $('#gbAdd');
    const gbSave = $('#gbSave');
    const gbClear = $('#gbClear');

    function renderGuestbook() {
      gbList.innerHTML = '';
      const all = JSON.parse(localStorage.getItem('guestbook')||'[]');
      all.forEach(it => {
        const div = document.createElement('div'); div.className = 'gb-item';
        div.innerHTML = `<strong>${it.name}</strong>: ${it.text} <div style="color:var(--muted); font-size:12px">${new Date(it.time).toLocaleString()}</div>`;
        gbList.appendChild(div);
      });
    }
    renderGuestbook();

    gbAdd.addEventListener('click', () => {
      const name = gbName.value.trim() || '–ê–Ω–æ–Ω–∏–º';
      const text = gbText.value.trim();
      if (!text) return alert('–ù–∞–ø–∏—à–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ!');
      const all = JSON.parse(localStorage.getItem('guestbook')||'[]');
      all.push({ name, text, time: Date.now() });
      localStorage.setItem('guestbook', JSON.stringify(all));
      gbText.value=''; renderGuestbook();
      confetti(); blip(780, .05);
    });

    gbSave.addEventListener('click', () => {
      const all = JSON.parse(localStorage.getItem('guestbook')||'[]');
      const content = '–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –†–æ–º—ã (14)\n\n' + all.map((x,i)=>`${i+1}. ${x.name} ‚Äî ${x.text} (${new Date(x.time).toLocaleString()})`).join('\n');
      const blob = new Blob([content], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'pozdravleniya_Rome.txt'; a.click();
      URL.revokeObjectURL(url);
    });
    gbClear.addEventListener('click', () => { if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è?')) { localStorage.removeItem('guestbook'); renderGuestbook(); }});

    // ---------------------- Quiz ----------------------
    const quizEl = $('#quiz');
    const quizData = [
      { q: '–°–∫–æ–ª—å–∫–æ –ª–µ—Ç –∏—Å–ø–æ–ª–Ω–∏–ª–æ—Å—å –†–æ–º–µ?', a: ['13','14','15'], right: 1 },
      { q: '–ö–∞–∫–æ–π —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∞–∑–¥–Ω–∏–∫?', a: ['–î–µ–Ω—å –†–æ–∂–¥–µ–Ω–∏—è –†–æ–º—ã','–ù–æ–≤—ã–π –ì–æ–¥','–•–µ–ª–ª–æ—É–∏–Ω'], right: 0 },
      { q: '–ß—Ç–æ –Ω–∞–¥–æ —Å–¥–µ–ª–∞—Ç—å?', a: ['–í–µ—Å–µ–ª–∏—Ç—å—Å—è! üéâ','–£—á–∏—Ç—å—Å—è','–°–ø–∞—Ç—å'], right: 0 }
    ];
    quizData.forEach((item, i) => {
      const q = document.createElement('div'); q.className = 'q';
      q.innerHTML = `<h3>${i+1}. ${item.q}</h3>` + item.a.map((opt, j)=>
        `<label><input type="radio" name="q${i}" value="${j}"> ${opt}</label>`
      ).join('');
      quizEl.appendChild(q);
    });
    $('#quizCheck').addEventListener('click', ()=>{
      let score = 0;
      quizData.forEach((item, i)=>{
        const v = document.querySelector(`input[name=q${i}]:checked`);
        if (v && Number(v.value) === item.right) score++;
      });
      const res = $('#quizResult'); res.style.display='inline-flex';
      res.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${score}/${quizData.length} ‚Äî ` + (score===quizData.length ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ' : '–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ üòâ');
      if (score === quizData.length) confetti();
    });

    // ---------------------- Music (WebAudio) ----------------------
    let audioCtx; let masterGain; let musicOn = false; let melodyId;
    function initAudio(){
      if (audioCtx) return; audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      masterGain = audioCtx.createGain(); masterGain.gain.value = 0.08; masterGain.connect(audioCtx.destination);
    }
    function note(freq, time, dur, type='sine'){
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq; o.connect(g); g.connect(masterGain);
      const t = audioCtx.currentTime + (time||0);
      o.start(t); g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(0.6, t+0.02); g.gain.exponentialRampToValueAtTime(0.0001, t + (dur||0.3));
      o.stop(t + (dur||0.3));
    }
    function blip(f=880, d=0.05){ if (!audioCtx) return; note(f, 0, d, 'triangle'); }

    const musicBtn = $('#musicBtn');
    musicBtn.addEventListener('click', ()=>{
      initAudio();
      musicOn = !musicOn; musicBtn.textContent = musicOn ? '–ú—É–∑—ã–∫–∞: –≤–∫–ª üîä' : '–ú—É–∑—ã–∫–∞: –≤—ã–∫–ª üîà';
      if (musicOn) startMelody(); else stopMelody();
    });

    function startMelody(){
      if (!audioCtx) return; stopMelody();
      const scale = [261.63, 293.66, 329.63, 392.00, 523.25]; // C D E G C
      let i = 0;
      melodyId = setInterval(()=>{
        note(scale[i%scale.length], 0, 0.18, 'sawtooth');
        i++;
      }, 220);
    }
    function stopMelody(){ if (melodyId) clearInterval(melodyId); }

    // ---------------------- Konami (cake rain) ----------------------
    const seq = ['–∫','–æ','–Ω','–∞','–º','–∏']; let idx = 0;
    addEventListener('keydown', (e)=>{
      const k = e.key.toLowerCase();
      if (k === seq[idx]) { idx++; if (idx===seq.length) { cakeRain(); idx=0; } }
      else { idx = (k===seq[0])?1:0; }
    });
    function cakeRain(){
      for(let i=0;i<60;i++) {
        const s = document.createElement('span'); s.textContent='üéÇ'; s.style.position='fixed'; s.style.left=rand(0,98)+'vw'; s.style.top='-10vh'; s.style.fontSize=rand(24,48)+'px'; s.style.opacity='.9'; s.style.zIndex=6; s.style.transition='transform 5s linear';
        document.body.appendChild(s);
        requestAnimationFrame(()=> s.style.transform = `translateY(${innerHeight + 200}px)`);
        setTimeout(()=> s.remove(), 5200);
      }
      confetti();
    }

    // ---------------------- Wishes reveal ----------------------
    const wishes = [
      '–ú–æ—Ä–µ —Ä–∞–¥–æ—Å—Ç–∏!', '–ö—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è!', '–ù–æ–≤—ã—Ö –ø–æ–±–µ–¥!', '–í–µ—Å—ë–ª—ã—Ö –¥—Ä—É–∑–µ–π!',
      '–Ø—Ä–∫–∏—Ö —ç–º–æ—Ü–∏–π!', '–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è!', '–ö–ª–∞—Å—Å–Ω—ã—Ö –∏–≥—Ä!', '–°–ª–∞–¥–∫–∏—Ö –¥–µ—Å–µ—Ä—Ç–æ–≤!',
      '–ü—è—Ç—ë—Ä–æ–∫ –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ!', '–ö—Ä—É—Ç–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!'
    ];
    const wishesEl = $('#wishes');
    wishes.forEach((t, i) => {
      const d = document.createElement('button');
      d.className = 'btn ghost';
      d.textContent = '???';
      d.setAttribute('aria-label', '–û—Ç–∫—Ä—ã—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏–µ');
      d.addEventListener('click', () => { d.textContent = t; blip(660 + i*10, 0.05); confetti(); });
      wishesEl.appendChild(d);
    });

    // Accessibility: reduce motion preference
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      $$('span', floaty).forEach(el => el.style.animationDuration = '60s');
    }
  </script>
</body>
</html>

